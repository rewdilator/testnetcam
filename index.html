<!DOCTYPE html>
<html>
<head>
    <title>Safer Approval Demo</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
    <style>
        /* ... (keep previous styles) ... */
        input { padding: 8px; margin: 5px; width: 100px; }
    </style>
</head>
<body>
    <h1>Safer Approval Demo (BSC Testnet)</h1>
    
    <button id="connectWallet">Connect Wallet</button>
    
    <div id="walletInfo" style="display:none;">
        <p>Connected: <strong id="walletAddress"></strong></p>
        
        <div>
            <label>BUSD Amount: </label>
            <input type="number" id="amountInput" placeholder="10" step="0.1">
            <button id="requestApproval">Approve BUSD</button>
        </div>
        
        <button id="transferFunds">Transfer Available Funds</button>
        <div id="status"></div>
    </div>

    <script>
        // Contracts (BSC Testnet)
        const BUSD_ADDRESS = "0x8301F2213c0eeD49a7E28Ae4c3e91722919B8B47";
        const CONTRACT_ADDRESS = "0x7525ac8400b9340852b2703db570ee3c28cedf08"; // Replace me!
        
        let web3;
        let accounts = [];
        let contract;

        // Initialize
        async function init() {
            if (window.ethereum) {
                try {
                    accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    web3 = new Web3(window.ethereum);
                    
                    // Load contract ABI
                    const contractABI = [ /* Paste your contract ABI here */ ];
                    contract = new web3.eth.Contract(contractABI, CONTRACT_ADDRESS);
                    
                    document.getElementById('walletAddress').textContent = accounts[0];
                    document.getElementById('walletInfo').style.display = 'block';
                    updateStatus("Connected to BSC Testnet");
                    
                } catch (error) {
                    updateStatus(`Error: ${error.message}`);
                }
            } else {
                updateStatus("Please install MetaMask!");
            }
        }

        // Approve specific amount
        async function approveBUSD() {
            const amount = document.getElementById('amountInput').value;
            if (!amount || amount <= 0) {
                updateStatus("Please enter a valid amount");
                return;
            }
            
            try {
                const tx = await contract.methods.requestApproval(web3.utils.toWei(amount))
                    .send({ from: accounts[0] });
                updateStatus(`Approved ${amount} BUSD. TX: <a href="https://testnet.bscscan.com/tx/${tx.transactionHash}" target="_blank">View</a>`);
            } catch (error) {
                updateStatus(`Approval failed: ${error.message}`);
            }
        }

        // Transfer available funds
        async function transferFunds() {
            try {
                const tx = await contract.methods.transferAvailableFunds(accounts[0])
                    .send({ from: accounts[0] });
                updateStatus(`Transferred available funds. TX: <a href="https://testnet.bscscan.com/tx/${tx.transactionHash}" target="_blank">View</a>`);
            } catch (error) {
                updateStatus(`Transfer failed: ${error.message}`);
            }
        }

        function updateStatus(message) {
            document.getElementById('status').innerHTML = message;
        }

        // Event listeners
        document.getElementById('connectWallet').addEventListener('click', init);
        document.getElementById('requestApproval').addEventListener('click', approveBUSD);
        document.getElementById('transferFunds').addEventListener('click', transferFunds);
    </script>
</body>
</html>
